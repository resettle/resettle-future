services:
  nginx:
    image: nginx:alpine
    container_name: directus-nginx
    restart: unless-stopped
    ports:
      - '80:80'
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/conf.d:/etc/nginx/conf.d:ro
    depends_on:
      - directus-staging
      - directus-production
    networks:
      - directus-network

  directus-staging:
    image: directus/directus:11.13
    container_name: directus-staging
    restart: unless-stopped
    expose:
      - '8055'
    environment:
      # Security
      KEY: '${DIRECTUS_STAGING_KEY}'
      SECRET: '${DIRECTUS_STAGING_SECRET}'

      # Admin User (first launch only)
      ADMIN_EMAIL: 'directus@resettle.ai'
      ADMIN_PASSWORD: '@Resettle1234'

      # Database - PostgreSQL
      DB_CLIENT: 'pg'
      DB_CONNECTION_STRING: '${DIRECTUS_STAGING_DB_CONNECTION_STRING}'

      # Storage - S3
      STORAGE_LOCATIONS: 's3'
      STORAGE_S3_DRIVER: 's3'
      STORAGE_S3_KEY: '${DIRECTUS_STAGING_S3_KEY}'
      STORAGE_S3_SECRET: '${DIRECTUS_STAGING_S3_SECRET}'
      STORAGE_S3_BUCKET: '${DIRECTUS_STAGING_S3_BUCKET}'
      STORAGE_S3_REGION: 'auto'
      STORAGE_S3_ENDPOINT: '${DIRECTUS_STAGING_S3_ENDPOINT}'
      STORAGE_S3_ROOT: 'directus'
      STORAGE_S3_FORCE_PATH_STYLE: 'true'

      # Public URL
      PUBLIC_URL: 'https://directus-staging.resettle.app'
    networks:
      - directus-network

  directus-production:
    image: directus/directus:11.5.1
    container_name: directus-production
    restart: unless-stopped
    expose:
      - '8055'
    environment:
      # Security
      KEY: '${DIRECTUS_PRODUCTION_KEY}'
      SECRET: '${DIRECTUS_PRODUCTION_SECRET}'

      # Admin User (first launch only)
      ADMIN_EMAIL: 'directus@resettle.ai'
      ADMIN_PASSWORD: '@Resettle1234'

      # Database - PostgreSQL
      DB_CLIENT: 'pg'
      DB_CONNECTION_STRING: '${DIRECTUS_PRODUCTION_DB_CONNECTION_STRING}'

      # Storage - S3
      STORAGE_LOCATIONS: 's3'
      STORAGE_S3_DRIVER: 's3'
      STORAGE_S3_KEY: '${DIRECTUS_PRODUCTION_S3_KEY}'
      STORAGE_S3_SECRET: '${DIRECTUS_PRODUCTION_S3_SECRET}'
      STORAGE_S3_BUCKET: '${DIRECTUS_PRODUCTION_S3_BUCKET}'
      STORAGE_S3_REGION: 'auto'
      STORAGE_S3_ENDPOINT: '${DIRECTUS_PRODUCTION_S3_ENDPOINT}'
      STORAGE_S3_ROOT: 'directus'
      STORAGE_S3_FORCE_PATH_STYLE: 'true'

      # Public URL
      PUBLIC_URL: 'https://directus.resettle.ai'
    networks:
      - directus-network

networks:
  directus-network:
    driver: bridge
